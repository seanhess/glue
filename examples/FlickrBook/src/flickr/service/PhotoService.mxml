<?xml version="1.0" encoding="utf-8"?>
<mx:Object xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:business="flickr.business.*" xmlns:model="flickr.model.*" xmlns:service="flickr.service.*">

	<model:Config id="config"/>
	
	<!-- Other Services -->
	<mx:HTTPService id="interestingness" url="{config.url}" resultFormat="e4x" result="onResult(event)">
		<mx:request>
			<api_key>{config.key}</api_key>
			<method>flickr.interestingness.getList</method>
		</mx:request>
	</mx:HTTPService>
	
	<mx:HTTPService id="searching" url="{config.url}" resultFormat="e4x" result="onResult(event)">
		<mx:request>
			<api_key>{config.key}</api_key>
			<method>flickr.photos.search</method>
			<user_id>{currentSearch.user}</user_id>
			<page>{currentSearch.page}</page>
			<tags>{currentSearch.tags}</tags>
		</mx:request>
	</mx:HTTPService>
	
	<service:FlickrParser id="parser"/>
	
	<mx:Script>
		<![CDATA[
			import mx.rpc.events.ResultEvent;
			import flickr.model.Photos;
			import flickr.model.Search;
			
			[Bindable] public var photos:Photos;
			[Bindable] private var currentSearch:Search;
		
			public function getInterestingness():void
			{
				interestingness.send();
			}
			
			public function search(value:Search):void
			{
				currentSearch = value;
				searching.send();
			}
			
			private function onResult(event:ResultEvent):void
			{
				var list:Array = parser.parseXML(event.result as XML);
				this.photos.storePhotos(list);
			}
		
		]]>
	</mx:Script>

</mx:Object>
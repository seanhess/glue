<?xml version="1.0" encoding="utf-8"?>
<Controller xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="http://glue.seanhess.net/2009" xmlns:control="books.control.*" xmlns:view="books.view.*" xmlns:browse="books.view.browse.*" xmlns:pages="books.view.pages.*" xmlns:model="books.model.*" xmlns:service="books.service.*">

	<mx:Script>
		<![CDATA[
			import books.model.Book;
			import mx.events.FlexEvent;
		]]>
	</mx:Script>
	
	<!-- MODELS -->
	<model:Library id="library"/>
	<model:Browse id="browse"/>
	<model:Search id="search"/>
	
	
	
	<!-- SERVICES -->
	<service:BrowseService id="browseService" browse="{browse}" library="{library}"/>
	<service:SearchService id="searchService" search="{search}" library="{library}"/>	




	
	
	<Glue>
		<view:MainView id="mainView"/>
		<Route event="{FlexEvent.CREATION_COMPLETE}" call="library.mock()"/>
		<Route event="{MainView.SEARCH}" call="browseService.showSearch()"/>
		<Route event="{MainView.BROWSE}" call="browseService.showBrowse()"/>
	</Glue>

	<Glue>
		<view:MainPagesView id="pages"/>
		
		<Inject child="{pages.back}" visible="{browse.backEnabled}"/>
		<Inject child="{pages.browseResults}" books="{library.books}" authors="{library.authors}"/>
		<Inject child="{pages.searchResults}" books="{search.bookResults}" authors="{search.authorResults}"/>
		
		<Route child="{pages.back}" event="click" call="browseService.goBack()"/>
		
		<Observe model="{browse}" event="goBack" call="pages.goBack()"/>
		<Observe model="{browse}" event="showSearch" call="pages.showSearch()"/>
		<Observe model="{browse}" event="showBrowse" call="pages.showBrowse()"/>
		<Observe model="{browse}" event="showBook" call="pages.showBook()"/>
		<Observe model="{browse}" event="showAuthor" call="pages.showAuthor()"/>
		
		<Observe model="{search}" event="search" call="pages.showSearchResults()"/>
	</Glue>
	
	<Glue>
		<pages:ResultsPage id="results"/>
		<Route event="{ResultsPage.SELECT_BOOK}" call="browseService.showBook(results.selectedBook)"/>
		<Route event="{ResultsPage.SELECT_AUTHOR}" call="browseService.showAuthor(results.selectedAuthor)"/>
	</Glue>
	
	<!-- 
		I could use MouseEvent.click instead of click here if I cared
	-->
	<Glue>
		<pages:BookPage id="bookView"/>
		<Inject book="{browse.currentBook}"/>
		<Route child="{bookView.authorButton}" event="click" call="browseService.showAuthor(bookView.book.author)"/>
	</Glue>
	
	<Glue>
		<pages:AuthorPage id="authorView"/>	
		<Inject author="{browse.currentAuthor}"/>
		<Route child="{authorView.booksList}" event="itemClick" call="browseService.showBook(authorView.booksList.selectedItem as Book)"/>
	</Glue>
	
	<Glue>
		<pages:SearchPage id="searchView"/>
		<Route child="{searchView.searchBtn}" event="click" call="searchService.doSearch(searchView.input.text)"/>
	</Glue>

</Controller>
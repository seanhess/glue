<?xml version="1.0" encoding="utf-8"?>
<GlueMap xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="http://glue.seanhess.net/2009" xmlns:control="books.control.*" xmlns:view="books.view.*" xmlns:browse="books.view.browse.*" xmlns:pages="books.view.pages.*" xmlns:model="books.model.*" xmlns:service="books.service.*">

	<mx:Script>
		<![CDATA[
			import books.model.Book;
			import mx.events.FlexEvent;
		]]>
	</mx:Script>
	
	<!-- MODELS -->
	<model:Library id="library"/>
	<model:Browse id="browse"/>
	<model:Search id="search"/>
	
	
	
	<!-- SERVICES -->
	<service:BrowseService id="browseService" browse="{browse}" library="{library}"/>
	<service:SearchService id="searchService" search="{search}" library="{library}"/>	




	
	
	<Glue>
		<view:MainView id="mainView"/>
		<Route event="{FlexEvent.CREATION_COMPLETE}" call="library.mock()"/>
		<Route event="{MainView.SEARCH}" call="browseService.showSearch()"/>
		<Route event="{MainView.BROWSE}" call="browseService.showBrowse()"/>
	</Glue>

	<Glue>
		<view:MainPagesView id="pages"/>
		
		<Inject child="{pages.back}" visible="{browse.backEnabled}"/>
		<Inject child="{pages.browseResults}" books="{library.books}" authors="{library.authors}"/>
		<Inject child="{pages.searchResults}" books="{search.bookResults}" authors="{search.authorResults}"/>
		
		<Route event="{MainPagesView.GO_BACK}" call="browseService.goBack()"/>
		
		<Route event="goBack" 		from="{browse}" to="pages.goBack()"/>
		<Route event="showSearch" 	from="{browse}" to="pages.showSearch()"/>
		<Route event="showBrowse" 	from="{browse}" to="pages.showBrowse()"/>
		<Route event="showBook" 	from="{browse}" to="pages.showBook()"/>
		<Route event="showAuthor" 	from="{browse}" to="pages.showAuthor()"/>
		
		<Route event="search"		from="{search}" call="pages.showSearchResults()"/>
	</Glue>
	
	<Glue>
		<pages:ResultsPage id="results"/>
		<Route event="{ResultsPage.SELECT_BOOK}" call="browseService.showBook(results.selectedBook)"/>
		<Route event="{ResultsPage.SELECT_AUTHOR}" call="browseService.showAuthor(results.selectedAuthor)"/>
	</Glue>
	
	<!-- 
		I could use MouseEvent.click instead of click here if I cared
	-->
	<Glue>
		<pages:BookPage id="bookView"/>
		<Inject book="{browse.currentBook}"/>
		<Route event="{BookPage.SELECT_AUTHOR}" call="browseService.showAuthor(bookView.book.author)"/>
	</Glue>
	
	<!-- It would be really cool if I could just do this -->
	
	<!--
		<pages:AuthorPage selectBook="" author="{browse.currentAuthor}"/>
		
		
	-->
	
	<Glue>
		<pages:AuthorPage id="authorView"/>	
		<Inject author="{browse.currentAuthor}"/>
		<Route event="{AuthorPage.SELECT_BOOK}" call="browseService.showBook(authorView.booksList.selectedItem as Book)"/>
	</Glue>
	
	<Glue>
		<pages:SearchPage id="searchView"/>
		<Route child="{searchView.searchBtn}" event="click" call="searchService.doSearch(searchView.input.text)"/>
	</Glue>

</GlueMap>